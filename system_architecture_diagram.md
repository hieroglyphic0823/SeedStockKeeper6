# SeedStockKeeper6 システム構成図

## アーキテクチャ概要

SeedStockKeeper6は、種子管理を目的としたAndroidアプリケーションです。Jetpack Composeを使用したモダンなUIと、Firebaseを活用したクラウド連携機能を提供します。

## システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                    SeedStockKeeper6 Android App                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   Presentation  │    │   Business      │    │    Data      │ │
│  │     Layer       │    │     Layer       │    │    Layer     │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    UI Layer (Jetpack Compose)              │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  MainActivity                                               │ │
│  │  ├── AuthGate (認証ゲート)                                  │ │
│  │  ├── MainScaffold (メインUI)                               │ │
│  │  └── AppNavHost (ナビゲーション)                           │ │
│  │                                                             │ │
│  │  Screens:                                                   │ │
│  │  ├── SeedListScreen (種子一覧)                             │ │
│  │  ├── SeedInputScreen (種子入力)                            │ │
│  │  ├── SettingsScreen (設定)                                 │ │
│  │  └── PlaceholderScreen (検索・カレンダー)                  │ │
│  │                                                             │ │
│  │  Components:                                                │ │
│  │  ├── SeedCalendar (カレンダー表示)                         │ │
│  │  ├── CalendarEntryEditor (カレンダー編集)                  │ │
│  │  ├── ImageDialog (画像表示)                                │ │
│  │  ├── AIDiffDialog (AI差分表示)                             │ │
│  │  └── RegionSelectionDialog (地域選択)                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  ViewModel Layer                            │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ├── SeedListViewModel (種子一覧管理)                       │ │
│  │  ├── SeedInputViewModel (種子入力管理)                      │ │
│  │  └── SettingsViewModel (設定管理)                           │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Data Layer                               │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  Models:                                                    │ │
│  │  ├── SeedPacket (種子パケット)                              │ │
│  │  ├── Cultivation (栽培情報)                                │ │
│  │  ├── CalendarEntry (カレンダーエントリ)                    │ │
│  │  └── CompanionPlant (コンパニオンプラント)                 │ │
│  │                                                             │ │
│  │  Data Helpers:                                              │ │
│  │  ├── GeminiOcrHelper (AI OCR処理)                          │ │
│  │  └── Utils (各種ユーティリティ)                            │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    External Services                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │    Firebase     │    │   Google AI     │    │   ML Kit     │ │
│  │   Services      │    │   (Gemini)      │    │  (TFLite)    │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Firebase Platform                        │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ├── Authentication (認証)                                  │ │
│  │  │   ├── Google Sign-In                                    │ │
│  │  │   └── Anonymous Auth                                    │ │
│  │  ├── Firestore (NoSQL データベース)                        │ │
│  │  │   └── seeds collection (種子データ)                     │ │
│  │  ├── Storage (ファイルストレージ)                          │ │
│  │  │   └── seed images (種子画像)                            │ │
│  │  └── Analytics (分析)                                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Google AI (Gemini)                       │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ├── Gemini 2.5 Flash Model                               │ │
│  │  ├── OCR (光学文字認識)                                    │ │
│  │  ├── 種子パッケージ解析                                    │ │
│  │  └── 栽培情報自動抽出                                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    ML Kit / TensorFlow Lite                 │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ├── Object Detection (物体検出)                           │ │
│  │  ├── CalendarDetector.tflite (カレンダー検出)              │ │
│  │  └── Image Processing (画像処理)                           │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 主要機能

### 1. 認証システム
- **Google Sign-In**: Credential Managerを使用した安全な認証
- **匿名認証**: ゲストユーザー向けの一時的なアクセス
- **Firebase Auth**: 認証状態の管理とセキュリティ

### 2. 種子管理機能
- **種子登録**: 手動入力 + AI OCR自動入力
- **画像管理**: Firebase Storageでの画像保存
- **栽培情報**: 間隔、温度、土壌準備などの詳細情報
- **カレンダー機能**: 地域別の播種・収穫スケジュール

### 3. AI機能
- **Gemini OCR**: 種子パッケージの自動解析
- **情報抽出**: 製品名、品種、栽培情報の自動抽出
- **コンパニオンプラント**: 相性の良い植物の推奨

### 4. データ管理
- **Firestore**: リアルタイム同期のNoSQLデータベース
- **オフライン対応**: ネットワーク切断時のデータ保持
- **画像ストレージ**: Firebase Storageでの効率的な画像管理

## 技術スタック

### フロントエンド
- **Android**: Kotlin + Jetpack Compose
- **UI Framework**: Material Design 3
- **Navigation**: Navigation Compose
- **State Management**: ViewModel + StateFlow

### バックエンド・サービス
- **Firebase**: 認証、データベース、ストレージ、分析
- **Google AI**: Gemini 2.5 Flash for OCR
- **ML Kit**: TensorFlow Lite for 画像処理

### 開発ツール
- **Build System**: Gradle with Kotlin DSL
- **Serialization**: Kotlinx Serialization
- **Image Loading**: Coil
- **Testing**: JUnit + Compose Testing

## データフロー

1. **種子登録フロー**:
   ```
   画像撮影 → Gemini OCR → 情報抽出 → ユーザー確認 → Firestore保存
   ```

2. **認証フロー**:
   ```
   アプリ起動 → AuthGate → 認証状態確認 → メイン画面 or ログイン画面
   ```

3. **データ同期フロー**:
   ```
   ローカル操作 → ViewModel → Firestore → リアルタイム同期 → UI更新
   ```

## セキュリティ考慮事項

- **API Key管理**: BuildConfigでの安全なAPI Key管理
- **認証**: Firebase Authによる安全なユーザー認証
- **データ保護**: Firestore Security Rulesによるデータアクセス制御
- **画像セキュリティ**: Firebase Storageでの安全な画像保存
